## What is Puppet?
Puppet is a tool that helps you manage and automate the configuration of servers.

When you use Puppet, you define the desired state of the systems in your infrastructure that you want to manage. You do this by writing infrastructure code in Puppet's Domain-Specific Language (DSL) — Puppet code — which you can use with a wide array of devices and operating systems. Puppet code is declarative, which means that you describe the desired state of your systems, not the steps needed to get there. Puppet then automates the process of getting these systems into that state and keeping them there. Puppet does this through Puppet primary server and a Puppet agent. The Puppet primary server is the server that stores the code that defines your desired state. The Puppet agent translates your code into commands and then executes it on the systems you specify, in what is called a Puppet run.

The diagram below shows how the server-agent architecture of a Puppet run works.

![server-agent architecture of a Puppet](https://puppet.com/docs/puppet/7/puppet_run.png)


The primary server and the agent are part of the Puppet platform, which is described in The Puppet platform — along with facts, catalogs and reports.

## Why use Puppet desired state management?
There are many benefits to implementing a declarative configuration tool like Puppet into your environment — most notably consistency and automation.

**Consistency.**  when you use configuration management, you are able to validate that Puppet applied the desired state you wanted. You can then assume that state has been applied, helping you to identify why your model failed and what was incomplete, and saving you valuable time in the process. Most importantly, once you figure it out, you can add the missing part to your model and ensure that you never have to deal with that same problem again.

**Automation.** When you manage a set of servers in your infrastructure, or you have plans to scale your infrastructure in the future, it is difficult to do this manually. This is where Puppet can help you — to save you time and money, to scale effectively, and to do so securely.

## The Puppet platform

Puppet is made up of several packages. Together these are called the Puppet platform, which is what you use to manage, store and run your Puppet code. These packages include puppetserver, puppetdb, and puppet-agent — which includes Facter and Hiera.

Puppet is configured in an agent-server architecture, in which a primary node (system) controls configuration information for one or more managed agent nodes. Servers and agents communicate by HTTPS using SSL certificates. Puppet includes a built-in certificate authority for managing certificates. Puppet Server performs the role of the primary node and also runs an agent to configure itself.

Facter, Puppet’s inventory tool, gathers facts about an agent node such as its hostname, IP address, and operating system. The agent sends these facts to the primary server in the form of a special Puppet code file called a manifest. This is the information the primary server uses to compile a catalog — a JSON document describing the desired state of a specific agent node. Each agent requests and receives its own individual catalog and then enforces that desired state on the node it's running on. In this way, Puppet applies changes all across your infrastructure, ensuring that each node matches the state you defined with your Puppet code. The agent sends a report back to the primary server.

You keep nearly all of your Puppet code, such as manifests, in modules. Each module manages a specific task in your infrastructure, such as installing and configuring a piece of software. Modules contain both code and data. The data is what allows you to customize your configuration. Using a tool called Hiera, you can separate the data from the code and place it in a centralized location. This allows you to specify guardrails and define known parameters and variations, so that your code is fully testable and you can validate all the edge cases of your parameters. If you have just joined an existing team that uses Puppet, take a look at how they organize their Hiera data.

All of the data generated by Puppet (for example facts, catalogs, reports) is stored in the Puppet database (PuppetDB). Storing data in PuppetDB allows Puppet to work faster and provides an API for other applications to access Puppet's collected data. Once PuppetDB is full of your data, it becomes a great tool for infrastructure discovery, compliance reporting, vulnerability assessment, and more. You perform all of these tasks with PuppetDB queries.

## PUPPET FORGE

Puppet Forge is a catalogue of modules created by Puppet, our partners, and community that helps IT ops practitioners supercharge and simplify their automation processes. With step-by-step guides and tutorials, Puppet Forge provides a platform for you to grow your skills with Puppet, whatever your current level.

Automate more with less effort on Puppet Forge.

## PUPPET DEVELOPMENT KID (PKD)

You can write your own Puppet code and modules using Puppet Development Kit (PDK), which is a framework to successfully build, test and validate your modules.

## LITMUS

Litmus is a command line tool that allows you to run acceptance tests against Puppet modules for a variety of operating systems and deployment scenarios. Acceptance tests validate that your code does what you intend it to do. 

## BOLT

Bolt is an open source orchestration tool that automates the manual work it takes to maintain your infrastructure. Use Bolt to automate tasks that you perform on an as-needed basis or as part of a greater orchestration workflow. For example, you can use Bolt to patch and update systems, troubleshoot servers, deploy applications, or stop and restart services. Bolt can be installed on your local workstation and connects directly to remote targets with SSH or WinRM, so you are not required to install any agent software.

_____________________
Puppet is declarative and pull configuration management, 1800 secs is the default time for puppet Agents to check-in with Puppet master


Puppet agent most be a Linux machine on port 8140 to communicate with agent through certificates

1. FACTS = current configuration of the agent

2. Catalog= list of cofiguration changes

3. Reports = report of the configuration on agents to master


## Puppet command

- List certificates requests: puppet cert list
- List all Certificates: puppet cert list --all
- Sign certificates: puppet cert sign
- clean certificate:  puppet cert clean
- generate certificate: puppet cert generate


Autosign en puppet para geenrar certificados autosign.conf


## Building blocks Puppet

### **Resource** 

A resource is a unit of configuration whose state can be managed by Puppet. Every resource has a type (such as file, service, or user), a title, and one or more attributes with specified values.

Types of resource

- Core/built-in
- Defined
- Custom

```
<Resource type> { <TITLE>:

<Attribute> => <Value>,
<Attribute> => <Value>,
<Attribute> => <Value>

}

________EXAMPLE______________

# NTP Package installation
package { "ntp:
    ensure => "present",
}


#NTP file configuration
file { "/etc/ntp.config":
    ensure => "present,
    content => "server pool.ntp.org\n",

}

# NTP Service startup
service { "ntpd":
    ensure => "running",

}

```


### **Class**

A class is a collection of related resources that, after it's defined, can be declared as a single unit. For example, a class can contain all of the resources (such as files, settings, modules, and scripts) needed to configure the Apache webserver on a host. Classes can also declare other classes.

```
class <class-name> { 

    < Resource Declaration>

}

________EXAMPLE______________
# Definition of a class
class ntpconfig {
    
    package { "ntp:
        ensure => "present",
    }

    file { "/etc/ntp.config":
        ensure => "present,
        content => "server pool.ntp.org\n",
    }

    service { "ntpd":
        ensure => "running",
    }


}

# Declaration of a class
inlcude ntpconfig
```

- create puppet class
- include puppet class
- Classes mus be unique and can be declared only once

### **Manifest or puppet code**

A manifest file contains code written in the Puppet language and is named with the .pp file extension. The Puppet code in a manifest can:
- Declare resources and classes.
- Set variables.
- Evaluate functions.
- Define classes, defined types, functions, and nodes.

Most manifests are contained in modules. Every manifest in a module defines a single class, defined type, or function.

## **Node Definitions**

A node definition is a collection of classes, resources, and variables in a manifest that are only applied to a certain agent node. Node definitions begin with the node keyword, and can match a node by full name or regular expression.


```
node "Name or names separated comma of a node(s)" { 

    include <class1>
    include <class1>

}

_________EXAMPLE_________

node "host01" {
    include ntpconfig
}

node 'default' {

}

````



### **Modules**

A module is a collection of classes, resource types, files, functions, and templates, organized around a particular purpose. For example, a module can configure an Apache web server instance or Rails application. There are many modules available for download in the Puppet Forge.





## Puppet Commands

- puppet help OR puppet --help
- List all action puppet resource --help
- List all resource types puppet resource --types
- consultar por tipo de recurso (user en este caso): puppet resource --type | grep -i user
- consultar atributos de un recurso (user en este caso): puppet describe user
- save all the .pp files puppet config print etc/puppetlabs/code/environments/production/manifests
- **site.pp** is the pooint contact between agent and master and is located in  etc/puppetlabs/code/environments/production/manifests/site.pp
- puppet config print | grep -i module

## Code Creation 

- **Create**
- **Check** puppet parser validate namefile.pp
- **Test** puppet apply namefile.pp --noop
- **Run** puppet apply namefile.pp

## Master/Agent Code creation

- **Create** (Master)
- **Check**  (Master) puppet parser validate namefile.pp
- **Test** (agent) puppet agent -tv --noop
- **Run**(agent) puppet agent -tv

### Varaibles in puppet

Variables store values so that those values can be accessed in code later.

Prefix variable names with a dollar sign ($). Assign values to variables with the equal sign (=) assignment operator.

````
Class "name of a class" {

    $<variable-Name> = <Value>
}

````

## Puppet Roles and Profiles

## Hiera
key value,
separate data from the code

## MCollective

change pull to push in puppet


